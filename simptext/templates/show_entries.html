{% extends "layout.html" %}
{% block body %}

<script type=text/javascript>
$(function() {
  //var lastInput = {{ entries | tojson }};
  //var merge = document.getElementById('merge').innerHTML;
  document.getElementById('merge-s1').style.visibility = "hidden";
  document.getElementById('merge-s2').style.visibility = "hidden";
  document.getElementById('merge-s').style.visibility = "hidden";

});

</script>

{% if session.logged_in %}
    <form action="{{ url_for('add_entry') }}" method=post class=add-entry>
      
      <dl>
        <dt>Input:
        <dd><textarea name=input rows=5 cols=60></textarea> 
        <!--
        <dt><small>The Edb List(default):</small>
        <dd><textarea name=words rows=2 cols=30></textarea> 
        -->    
        <dd><input type=submit value=Simplify>

      </dl>

    </form>

<ul class="entries" id="entry">
  {% if entries %}
     <li><h2>Input:</h2>
     <li>
     {{ entries }}
     </li>
  {% else %}
     <li><em>No output here so far</em>
  {% endif %}

  <li><h2>Output:<h2></li>
  {% set counter = ['1'] %}
  
  {% if s1_child_output|length > 0 %} {# there is the child #}
  <li id="reverse-{{counter|length}}" contenteditable="true" 
  draggable="true" ondragenter="dragenter(event)" ondragstart="dragstart(event)">
   {% for item in s1_child_output %}  
        {% if item is mapping %} {# not change #}
   
          {% for key, value in item.iteritems() %}
            <select>
              {% for v in value %}
                 <option value={{ v }} >{{ v |safe}} </option>
              {% endfor %}
            </select>
         
          {% endfor %}

        {% else %}
           {{ item |safe }}

           {% if item == "." %}  {# is a sentence? #}
               
               {% if counter|length == 2 %}
                   <input type='button' id="undo-{{counter|length}}" value='Merge'/>
               {% endif %}
                
               {% if counter.append('1') %}
               {% endif %}
                 
               <br></li>    
                {% if counter|length < 3 %}
                    
                    <li id="reverse-{{counter|length}}" contenteditable="true" 
                    draggable="true" ondragenter="dragenter(event)" ondragstart="dragstart(event)"> 
                {% endif %} 

           {% endif %}
              
        {% endif %}  

   {% endfor %}  
   </li>

{% else %}  {# no children, but we can make sure that there is S2  #}
 <li id="reverse-{{counter|length}}" contenteditable="true" 
 draggable="true" ondragenter="dragenter(event)" ondragstart="dragstart(event)">
      {% for item in s1_output %}     
        {% if item is mapping %} {# not change #}
   
          {% for key, value in item.iteritems() %}
            <select>
              {% for v in value %}
                 <option value={{ v }} >{{ v |safe}} </option>
              {% endfor %}
            </select>
         
          {% endfor %}

        {% else %}
           {{ item |safe }}

           {% if item == "." %}  {# is a sentence? #}
               {% if counter|length == 2 %}
               <input type='button' id="undo-{{counter|length}}" value='Merge'/>
               {% endif %}

               {% if counter.append('1') %}
               {% endif %}
              
           {% endif %}
              
        {% endif %}
   {% endfor %} 
</li>
{% endif %}


{% set cnt = 5 %}
{% if s2_child_output|length > 0 %} {# there is the child in S2 #}
  <li id="reverse-{{cnt}}" contenteditable="true" 
  draggable="true" ondragenter="dragenter(event)" ondragstart="dragstart(event)">
   {% for item in s2_child_output %}  
        {% if item is mapping %} {# not change #}
   
          {% for key, value in item.iteritems() %}
            <select>
              {% for v in value %}
                 <option value={{ v }} >{{ v |safe}} </option>
              {% endfor %}
            </select>
         
          {% endfor %}

        {% else %}
           {{ item |safe }}

           {% if item == "." %}  {# is a sentence? #}
               
               {% if cnt|int == 6 %}
                   <input type='button' id="undo-{{cnt}}" value='Merge'/>
               {% endif %}
                
               {% set cnt = cnt + 1 %}
                 
               <br></li>    
                {% if cnt|int < 7 %}
                    <li id="reverse-{{cnt}}" contenteditable="true"  
                    draggable="true" ondragenter="dragenter(event)" ondragstart="dragstart(event)" > 
                {% endif %} 

           {% endif %}
              
        {% endif %}  

   {% endfor %}  
   </li>

{% else %}  {# no children in S2  #}
 <li id="reverse-{{cnt}}" contenteditable="true"  
 draggable="true" ondragenter="dragenter(event)" ondragstart="dragstart(event)">
      {% for item in s2_output %}   
         
        {% if item is mapping %} {# not change #}
   
          {% for key, value in item.iteritems() %}
            <select>
              {% for v in value %}
                 <option value={{ v }} >{{ v |safe}} </option>
              {% endfor %}
            </select>
         
          {% endfor %}

        {% else %}
           {{ item |safe }}

           {% if item == "." %}  {# is a sentence? #}
               
               <input type='button' id="undo-{{cnt}}" value='Merge'/>
              
           {% endif %}
              
        {% endif %}
   {% endfor %} 
</li>
{% endif %}


{% if s1_output|length == 0  %}
    {% if s2_output|length == 0  %}
    <li>
        {% for item in s_outputs %} 
        {% if item is mapping %} {# not change #}
   
          {% for key, value in item.iteritems() %}
            <select>
              {% for v in value %}
                 <option value={{ v }} >{{ v |safe}} </option>
              {% endfor %}
            </select>
         
          {% endfor %}

        {% else %}
           {{ item |safe }}
              
        {% endif %}

        {% endfor %} 
    </li>
    {% endif %}
{% endif %}

</ul>

{% endif %}

{% include 'merge.html' %}

{% include 'footer.html' %}

{% endblock %}
